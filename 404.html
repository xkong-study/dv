<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>第一个 ECharts 实例</title>
  <script src="https://fastly.jsdelivr.net/npm/jquery"></script>
  <script src="https://fastly.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
  <script src="https://fastly.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
  <script src="https://echarts-maps.github.io/echarts-countries-js/echarts-countries-js/Ireland.js"></script>
</head>
<body>
<div id="chart-container" style="position: relative;height: 100vh; overflow: hidden;"></div>
<script type="text/javascript">
  var dom = document.getElementById('chart-container');
  var myChart = echarts.init(document.getElementById('chart-container'));
  var option;
  filePath='./dublin.csv'
  function csvToJson(filePath) {
    let result = []
    var xhr = new XMLHttpRequest();
    xhr.open("GET", filePath, false);
    xhr.onload = function (e) {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          result = csvJSON(xhr.responseText)
        } else {
          console.error(xhr.statusText);
        }
      }
    };
    xhr.send(null);
    return result
  }

  function csvJSON(csv) {
    var lines = csv.split("\n");

    var result = [];

    var headers = lines[0].split(",");

    for (var i = 1; i < lines.length; i++) {
      var obj = {};
      var currentline = lines[i].split(",");

      for (var j = 0; j < headers.length; j++) {
        obj[headers[j]] = currentline[j];
      }

      result.push(obj);
    }

    return result;
  }
  const routes1=[[[53.2945, -6.13443],[53.3413, -6.28366]],[[53.3654, -6.27161],[53.3665, -6.31908]],[[53.3697, -6.34877],[53.3346, -6.27462]],[[53.3408, -6.26877],[0,0]]]
  const routes=[]
  const table= csvToJson(filePath)
  myChart.showLoading();
  for(let i=0;i<5000;i++){
    if(parseFloat(table[i].Latitude)!=0 && parseFloat(table[i].Longitude)!=0 && parseFloat(table[i+1].Latitude)!=0 && parseFloat(table[i+1].Longitude)!=0) {
      routes.push([[parseFloat(table[i].Longitude), parseFloat(table[i].Latitude)], [parseFloat(table[i + 1].Longitude), parseFloat(table[i + 1].Latitude)]]);
      i = i + 1
    }
  }
    console.log(routes)
  myChart.hideLoading();
  myChart.setOption({
    geo3D: {
      map: '爱尔兰',
      zoom: 10,
      shading: 'realistic',
      silent: true,
      environment: '#333',
      realisticMaterial: {
        roughness: 0.8,
        metalness: 0
      },
      postEffect: {
        enable: true
      },
      groundPlane: {
        show: false
      },
      light: {
        main: {
          intensity: 1,
          alpha: 30
        },
        ambient: {
          intensity: 0
        }
      },
      viewControl: {
        distance: 70,
        alpha: 89,
        panMouseButton: 'left',
        rotateMouseButton: 'right'
      },
      itemStyle: {
        color: '#000'
      },
      regionHeight: 0.5
    },
    series: [
      {
        type: 'lines3D',
        coordinateSystem: 'geo3D',
        effect: {
          show: true,
          trailWidth: 1,
          trailOpacity: 1,
          trailLength: 0.2,
          constantSpeed: 5
        },
        blendMode: 'lighter',
        lineStyle: {
          width: 0.2,
          opacity: 0.05
        },
          data: routes
        }
      ]
    });
    window.addEventListener('keydown', function () {
      myChart.dispatchAction({
        type: 'lines3DToggleEffect',
        seriesIndex: 0
      });
    });

  if (option && typeof option === 'object') {
    myChart.setOption(option);
  }
  option.geo.center = undefined
  window.addEventListener('resize', myChart.resize);
</script>
</body>
</html>
